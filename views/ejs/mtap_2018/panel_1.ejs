

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="Uma p&aacute;gina para anota&ccedil;&atilde;o de v&iacute;deo.">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
<title></title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
<link href="https://code.getmdl.io/1.3.0/material.indigo-blue.min.css" rel="stylesheet" />
<script defer src="https://code.getmdl.io/1.3.0/material.min.js">
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js">
</script>
</script>
<style type="text/css">.modal {
  display: none;
  font-size:30px;
  text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;
  color: white;
  position: fixed;
  z-index: 100;
  padding-top: 100px;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgb(0,0,0);
  background-color: rgba(0,0,0,0.75);
}
  .modal-content {
    background-color: #fefefe;
    margin: auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
  }
  .close {
    color: #aaaaaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
  }
  .close:hover,
  .close:focus {
    color: #000;
    text-decoration: none;
    cursor: pointer;
  }

table {
  border: 1px #c0c0c0 solid;
  width: 100%;
}
table th {
  background-color: #00f;
  color: #fff;
}
table td {
  color: #0c0c0c;
}

</style>
<div style='background:#3F51B5;'>
<center>
  <table>
    <tbody>

          <a class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" id="bt" onclick="aggregate()" style="display:block;height:33px;width: 300px;box-shadow: 12px 29px 81px 0px rgba(0,0,0,0.75);-moz-box-shadow: 12px 29px 81px 0px rgba(0,0,0,0.75);-webkit-box-shadow: 12px 29px 81px 0px rgba(0,0,0,0.75);">Proceed Aggregation</a>
<br>
          <a class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" id="bt" onclick="updateConvergence()" style="display:block;height:33px;width: 300px;box-shadow: 12px 29px 81px 0px rgba(0,0,0,0.75);-moz-box-shadow: 12px 29px 81px 0px rgba(0,0,0,0.75);-webkit-box-shadow: 12px 29px 81px 0px rgba(0,0,0,0.75);">Continue Collecting</a>


    </tbody>
  </table>
</center>
</div>

<div id="container"></div>

  </div>


</div>

</div>
<script>
        var vInfo = new Array();
        vInfo[0] = {uri:'ALM8JW3O_3w',start:0,end:119};
        vInfo[1] = {uri:'nWvdxcyI6DY',start:0,end:66};
        vInfo[2] = {uri:'_vbPf-uouqA',start:0,end:116};

	var fx = new Array();
	fx[0] = new Array();
	fx[0][0] = new Array();
	fx[0][1] = new Array();
	fx[1] = new Array();
	fx[1][0] = new Array();
	fx[1][1] = new Array();
	fx[2] = new Array();
	fx[2][0] = new Array();
	fx[2][1] = new Array();


	var fxc = new Array();
	fxc[0] = new Array();
	fxc[0][0] = new Array();
	fxc[0][1] = new Array();
	fxc[1] = new Array();
	fxc[1][0] = new Array();
	fxc[1][1] = new Array();
	fxc[2] = new Array();
	fxc[2][0] = new Array();
	fxc[2][1] = new Array();


        var total = new Array();
        total[0]=new Array();
        total[0][0]=0;
        total[0][1]=0;
        total[1]=new Array();
        total[1][0]=0;
        total[1][1]=0;
        total[2]=new Array();
        total[2][0]=0;
        total[2][1]=0;

        var contribs = new Array();
        contribs[0]=0;
        contribs[1]=0;
        contribs[2]=0;

    	$.getJSON('https://novaes.tech/contributions', function(data){init(data);});



  	function init(c){
	

		for(var i=0; i<c.length; i++){

			
			var ranges = c[i].ranges.split(',');
                	var v;        
		        switch(c[i].uri){
                                case vInfo[0].uri:
                                        v=0;
                                        break;
                                case vInfo[1].uri:
                                        v=1;
                                        break;
                                case vInfo[2].uri:
                                        v=2;
                                        break;
                     	}

			contribs[v] = contribs[v] + 1;

			for(var j=0; j<ranges.length; j++){

				var m = ranges[j].split(':');
				var contrib = {start:parseFloat(m[1]),end:parseFloat(m[2])};

				var f;
				switch(m[0]){
					case 'WIND': f=0; break;
					case 'VIBRATION': f=1; break;
				}

				total[v][f] = total[v][f] + 1;
				fx[v][f].push(contrib);
			}
		}


		for(var i=0; i<3; i++){
			for(var j=0; j<2; j++){
				fx[i][j] = fx[i][j].sort(function(a, b){return parseFloat(a.start)-parseFloat(b.end)});
			}
		}


		console.log(contribs,total,fx);

//		createTable(fx);
	}


	function createTable(list){



console.log(cv,mt,mv,marks,videos);




var container = document.getElementById("container");
table= [];


for(var v=0; v<3; v++){

list_points = list[v];


table.push(
  '<table>',
  '<thead>',
  '<tr>',
  '<th>Video</th>',
  '<th>Contributions</th>',
  '<!--th>Marks from Contributions</th-->',
  '<th>Filtered Marks</th>',
  '<th>Agreement Rate</th>',
  '<th>Extracted Segments</th>',
  '</tr>',
  '</thead>',
  '<tbody>',
'<tr align=center>',
'<td>',vInfo[v].uri,'</td>',
'<!--td>',cv[v],'</td-->',
'<td>',mt[v],'</td>',
'<td>',mv[v],'</td>',
'<td>',Math.ceil(100*mv[v]/mt[v]),'%</td>',
'<td>',marks[v].length,'</td>',
  '</tbody>',
  '</table>',
  '<table>',
  '<thead>',
  '<tr>',
  '<th>Done</th>',
  '<th>Instant</th>',
  '<th>Convergence</th>',
  '</tr>',
  '</thead>',
  '<tbody>'
);







for(var i=0; i<list_points.length; i++){
var point = list_points[i];









var color = '#00C060';
var checked = 'checked';
if(point.cvg < 30) color = '#00FA9A';
if(point.cvg < 20){
	color = '#FFD700';
	checked = null;
}
if(point.cvg < 17) color = '#F4A460';
if(point.cvg <= 15) color = '#CD5C5C';




table.push(
  '<tr bgcolor="'+color+'" align=center >',
  '<td align="center"><input type="checkbox" name="ck" '+checked+'  ></td>',
  '<td><b>'+point.mark+'</b></td>',
  '<td><b>'+Math.ceil(point.cvg)+'%'+'</b></td>',
  '</tr>'
);

}

table.push(
  '</tbody>',
  '</table>'
);


}



container.innerHTML = table.join("\n");

	}


	function addContribution(groups, c){
		var i;
		for(i=0; i<groups.length; i++){
			if(parseInt(groups[i].segment.start) == parseInt(c.start)){
				groups[i].contributions.push(c);
				break;
			}
		}
	}

        function levenshtein(a, b){
                var tmp;
                if (a.length === 0) { return b.length; }
                if (b.length === 0) { return a.length; }
                if (a.length > b.length) { tmp = a; a = b; b = tmp; }

                var i, j, res, alen = a.length, blen = b.length, row = Array(alen);
                for (i = 0; i <= alen; i++) { row[i] = i; }

                for (i = 1; i <= blen; i++) {
                        res = i;
                        for (j = 1; j <= alen; j++) {
                                tmp = row[j - 1];
                                row[j - 1] = res;
                                res = b[i - 1] === a[j - 1] ? tmp : Math.min(tmp + 1, Math.min(res + 1, row[j] + 1));
                        }
                }
                return res;
        }


	function aggregate(){
		alert('Aggregate');

	}

	function updateConvergence(){
		var convergeds = new Array();
		var dones = document.getElementsByName("ck");
		for(var i=0; i<dones.length; i++){
			if(dones[i].checked){
				delete list_points[i].fingerprint;
				delete list_points[i].job_id;
				delete list_points[i].candidates;
				delete list_points[i].contributions;
				delete list_points[i]._id;
				convergeds.push(list_points[i]);
			}
		}

	      $.ajax({
	        	type: 'POST',
      	 	 	url: 'https://novaes.tech/updateConvergence',
        		data: {'points':convergeds},
	        	success: function(result, status, request) {done(result);}
      		});
	}

        function aggregate(){
		var contributions = new Array();
		for(var i=0; i<3; i++){
			for(var j=1; j<marks[i].length; j++){
				var c = {};
				c.uri = vInfo[i].uri;
				c.start = marks[i][j-1].mark;
				c.end = marks[i][j].mark;
				contributions.push(c);
			}
		}
/*

                var convergeds = new Array();
                var dones = document.getElementsByName("ck");
                for(var i=0; i<dones.length; i++){
                        if(dones[i].checked){
                                convergeds.push(contributions[i]);
                        }
                }


console.log(convergeds);
*/

console.log(contributions);

              $.ajax({
                        type: 'POST',
                        url: 'https://novaes.tech/aggregate',
                        data: {'points':contributions},
                        success: function(result, status, request) {done(result);}
                });
        }




	function done(result){
		alert('Success');
	}

 
</script>



