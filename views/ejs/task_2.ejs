

<!DOCTYPE html>

<html lang="pt-br">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="Uma página para anotação de vídeo.">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
<title>CrowdNote</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-blue.min.css" />
<link rel="stylesheet"  href='include?name=client.min&mime=css' >
<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src='https://novaes.tech/include?name=client.min&mime=js'></script>
</head>


<body align='center'>

  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
    <header class="mdl-layout__header" style="height:240px;">
      <div class="mdl-layout__header-row" >
        <span class="mdl-layout-title" style='text-align:left;font-size:16px;position: fixed;margin-top:90px; margin-left:10px;'> 

<center>
<table>
<td width='500' >
<p style="font-size:16px">Based on the video, suggest content to explain or illustrate:</p>
<p style="font-size:22px;text-align:center;background:white;vertical-align: middle; color: rgb(68,138,255);font-style: italic;border-style:solid;height:50px;line-height:50px;" id="tx_point"></p>
<p style="font-size:16px">1. Select the type of content to send.</p>
<p style="font-size:16px">2. Type, paste or choose the content.</p>
<p style="font-size:16px">3. Click the 'SUBMIT' button.</p>
</td>

<td width='600' align='center'>
<p id='content_view' name='content_view'  style='word-wrap: break-word;font-size:16px;height:180px;width: 407px;box-shadow: 12px 29px 81px 0px rgba(0,0,0,0.75);-moz-box-shadow: 12px 29px 81px 0px rgba(0,0,0,0.75);-webkit-box-shadow: 12px 29px 81px 0px rgba(0,0,0,0.75);'>
</p>
<button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" id='bt_previous'    onClick="navigate(-1)" style='font-size:12px;height:30px;width: 100px;box-shadow: 12px 29px 81px 0px rgba(0,0,0,0.75);-moz-box-shadow: 12px 29px 81px 0px rgba(0,0,0,0.75);-webkit-box-shadow: 12px 29px 81px 0px rgba(0,0,0,0.75);'>previous</button>
<button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" id='bt_vote'    onClick="sendContribution()" style='font-size:12px;height:30px;width: 200px;box-shadow: 12px 29px 81px 0px rgba(0,0,0,0.75);-moz-box-shadow: 12px 29px 81px 0px rgba(0,0,0,0.75);-webkit-box-shadow: 12px 29px 81px 0px rgba(0,0,0,0.75);'>VOTE !!!</button>
<button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" id='bt_next'    onClick="navigate(1)" style='font-size:12px;height:30px;width: 100px;box-shadow: 12px 29px 81px 0px rgba(0,0,0,0.75);-moz-box-shadow: 12px 29px 81px 0px rgba(0,0,0,0.75);-webkit-box-shadow: 12px 29px 81px 0px rgba(0,0,0,0.75);'>next</button>
</td>

</table>
</center>



	</span>

      </div>
    </header>
 
<div style='padding: 10px;'>

	  <div id="player" style='box-shadow: 12px 29px 81px 0px rgba(0,0,0,0.75);-moz-box-shadow: 12px 29px 81px 0px rgba(0,0,0,0.75);-webkit-box-shadow: 12px 29px 81px 0px rgba(0,0,0,0.75);'></div>
	  
		
	</div>


<input type='hidden' id='done' name='done' >

</div>


<script>

var input;
var item;
var cur = 0;
var player;
var delta;
var duration;
var content_type;
var content_view;
var tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

function displayContent(idx){
	content_type = input[idx].content_type;
	var content = input[idx].content;

	switch(content_type){
		case 'image':
				content = "<img src="+content+" style='height:180px; max-width:407px;'>";
			break;

	}

	content_view.innerHTML = content;
}

function navigate(step){
	if( (cur+step < input.length) && (cur+step >= 0) ){
		cur += step;
		displayContent(cur);
	}
}


function readURL(input,output) {

    if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function (e) {
            	output.attr('src', e.target.result);
		image = e.target.result;
        }

        reader.readAsDataURL(input.files[0]);
    }
}


function onYouTubeIframeAPIReady() {
  $.getJSON('https://novaes.tech/job', function(data){init(data);});
}

function init(data){
  input = data;
  item = input[0];
  document.getElementById("tx_point").innerHTML = item.point;

  content_view = document.getElementById("content_view");
  displayContent(0);

  player = new YT.Player(
    'player',
    {
      autoplay : 0,
      controls: 2,
      height: '360',
      width: '640',
      events: {
        'onReady': onPlayerReady,
        'onStateChange': onPlayerStateChange
      }
    }
  );

}

function onPlayerReady(event) {
    	duration = item.end - item.start;
        player.loadVideoById(item.uri, parseFloat(item.instant) -1);
}

function onPlayerStateChange(event) {
  if (event.data == YT.PlayerState.PLAYING) {
    setTimeout(restartVideoSection, duration * 1000);
  }
}

function restartVideoSection() {
  	player.seekTo(parseFloat(item.instant) -1);
	player.pauseVideo();
}


	
function sendContribution(){

	if(contrib.value != ''){

		item = input[cur];

		var queryForm = "<form method='post' action='https://novaes.tech/store'>";
		queryForm += "<input type='hidden' id='uri' name='uri'  value='"+item.uri+"' > ";
		queryForm += "<input type='hidden' id='start' name='start'  value='"+item.start+"' > ";
		queryForm += "<input type='hidden' id='end' name='end'  value='"+item.end+"' > ";
		queryForm += "<input type='hidden' id='fingerprint' name='fingerprint'  value='"+item.fingerprint+"' > ";
		queryForm += "<input type='hidden' id='job_id' name='job_id'  value='"+item.job_id+"' > ";
		queryForm += "<input type='hidden' id='item_index' name='item_index'  value='"+item.item_index+"' > ";
		queryForm += "<input type='hidden' id='instant' name='instant'  value='"+item.instant+"' > ";
		queryForm += "<input type='hidden' id='point' name='point'  value='"+item.point+"' > ";
	
		queryForm += "<input type='hidden' id='content_type' name='content_type'  value='"+item.content_type+"' > ";

		queryForm += "<input type='hidden' id='content' name='content'  value='"+item.content+"' > ";


		queryForm += "</form>";

		

		$.ajax({
			type: 'POST',
			url: $(queryForm).attr('action'),
			data: $(queryForm).serialize(), 
			success: function(result, status, request) {done();}
		});
	}else{
                alert("You forgot to suggest some content.\nYour contribution is important to us!!!");
	}
}

function done(){
	var done = document.getElementById("done");
	done.value='ok';
	player.stopVideo();
	$(location).attr('href', 'thanks');
}	



</script>





